<div class="estadisticas-root">
  <div class="estadisticas-container">
    <h2>üìä Estad√≠sticas del Sistema</h2>

    <!-- SECCI√ìN DE CONTROLES -->
    <div class="controles">
      <div class="control-grupo">
        <label>Tabla:</label>
        <select [(ngModel)]="selectedDataset" (change)="onDatasetChange()">
          <option *ngFor="let d of resultados" [value]="d.key">{{ d.label }}</option>
        </select>
      </div>

      <div class="control-grupo">
        <label>Buscar:</label>
        <input type="text" [(ngModel)]="searchTerm" (keyup.enter)="aplicarFiltros()" placeholder="texto libre..." />
      </div>

      <div class="control-grupo">
        <label>Campo:</label>
        <select [(ngModel)]="campoFiltro">
          <option value="">(ninguno)</option>
          <option *ngFor="let c of columnas" [value]="c">{{ c }}</option>
        </select>
      </div>

      <div class="control-grupo">
        <label>Valor:</label>
        <input type="text" [(ngModel)]="valorFiltro" (keyup.enter)="aplicarFiltros()" placeholder="valor..." />
      </div>

      <button (click)="exportarExcel()" class="btn-accent">üì§ Exportar Excel</button>
    </div>

    <!-- CONSULTA SQL PERSONALIZADA -->
    <div class="sql-container">
      <h3>üß† Consulta SQL personalizada</h3>
      <textarea [(ngModel)]="customSQL" rows="4" cols="80"
        placeholder="Escribe aqu√≠ tu sentencia SQL completa..."></textarea>
      <div class="sql-buttons">
        <button (click)="ejecutarCustomSQL()" class="btn-primary">Ejecutar SQL</button>
        <button (click)="customSQL=''" class="btn-secondary">Limpiar</button>
      </div>
    </div>

    <!-- MENSAJE DE ESTADO -->
    <div *ngIf="loading" class="loading">‚è≥ Cargando datos...</div>
    <div *ngIf="error" class="error">‚ö†Ô∏è {{ error }}</div>

    <!-- TABLA DE RESULTADOS -->
    <div class="tabla-wrapper" *ngIf="!loading && rawData && rawData.length > 0">
      <table class="tabla-resultados">
        <thead>
          <tr>
            <th *ngFor="let col of columnas">{{ col }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let fila of rawData | slice:0:50">
            <td *ngFor="let col of columnas">
              {{ fila[col] }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!loading && rawData.length === 0" class="sin-datos">
      No hay resultados para mostrar.
    </div>
  </div>
</div>